<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Security Meta Tags -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://generativelanguage.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' https://images.unsplash.com https://placehold.co data:; connect-src 'self' https://generativelanguage.googleapis.com; form-action 'self' https://formsubmit.co;">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta name="referrer" content="strict-origin-when-cross-origin">

    <title>Helionenergies - Powering India's Sustainable Future</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Styles for a more polished look */
        :root {
            --primary-color: #2a9d8f; /* Teal Green */
            --secondary-color: #264653; /* Dark Blue/Green */
            --accent-color: #f4a261; /* Sandy Orange */
            --text-color: #333;
            --bg-color: #ffffff;
            --light-gray: #f8f9fa;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            color: var(--text-color);
            background-color: var(--bg-color);
        }

        .font-logo {
            font-family: 'Lexend Deca', sans-serif;
        }
        
        .cta-button {
            background-color: var(--accent-color);
            transition: background-color 0.3s ease;
        }

        .cta-button:hover {
            background-color: #e76f51; /* Darker Orange */
        }
        
        .primary-button {
            background-color: var(--primary-color);
            transition: background-color 0.3s ease;
        }
        .primary-button:hover {
            background-color: var(--secondary-color);
        }

        /* Spinner for loading state */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border-left-color: var(--primary-color);
            animation: spin 1s ease infinite;
            display: none; /* Hidden by default */
            margin: 20px auto;
        }
        
        .mini-spinner {
             border: 2px solid rgba(0, 0, 0, 0.1);
             width: 16px;
             height: 16px;
             border-left-color: var(--primary-color);
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        /* Tooltip Styles */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: pointer;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background-color: var(--secondary-color);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -110px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.875rem;
            font-weight: normal;
        }

        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--secondary-color) transparent transparent transparent;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Lexend+Deca:wght@700&display=swap" rel="stylesheet">
</head>
<body class="bg-white">

    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="text-3xl font-bold font-logo" style="color: var(--primary-color);">Helionenergies</a>
            <ul class="hidden md:flex items-center space-x-8">
                <li><a href="#ai-calculator" class="text-gray-700 hover:text-[var(--primary-color)] font-semibold">✨ Savings Calculator</a></li>
                <li><a href="#about" class="text-gray-700 hover:text-[var(--primary-color)] font-semibold">About Us</a></li>
                <li><a href="#blog" class="text-gray-700 hover:text-[var(--primary-color)] font-semibold">Blog</a></li>
                <li><a href="#contact" class="text-gray-700 hover:text-[var(--primary-color)] font-semibold">Contact</a></li>
            </ul>
            <a href="#contact" class="hidden md:block cta-button text-white font-bold py-2 px-6 rounded-lg">Get a Quote</a>
        </nav>
    </header>

    <main>
        <!-- Hero Section -->
        <section class="bg-cover bg-center text-white" style="background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('https://images.unsplash.com/photo-1509391366360-2e959784a276?q=80&w=2070')">
            <div class="container mx-auto px-6 text-center py-24 md:py-32">
                <h1 class="text-4xl md:text-6xl font-bold mb-4">Powering India's Sustainable Future</h1>
                <p class="text-lg md:text-xl mb-8 max-w-3xl mx-auto">Helionenergies makes clean, renewable energy accessible and affordable. See how much you could save with our new AI-powered calculator.</p>
                <a href="#ai-calculator" class="cta-button text-white font-bold py-4 px-8 rounded-lg text-lg">✨ Calculate Your Savings</a>
            </div>
        </section>
        
        <!-- AI Savings Calculator Section -->
        <section id="ai-calculator" class="py-20 bg-[var(--light-gray)]">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-4 text-[var(--secondary-color)]">✨ AI-Powered Solar Savings Calculator</h2>
                <p class="text-center text-gray-600 mb-12 max-w-2xl mx-auto">Enter your details below and our AI will estimate your energy usage based on your state's tariffs to provide a more accurate solar recommendation.</p>
                <div class="max-w-xl mx-auto bg-white p-8 rounded-lg shadow-2xl">
                    <div class="grid grid-cols-1 gap-6">
                        <div>
                            <label for="monthly-bill" class="block text-sm font-medium text-gray-700">Average Monthly Electricity Bill (in ₹)</label>
                            <input type="number" id="monthly-bill" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)] sm:text-sm p-3" placeholder="e.g., 2500">
                        </div>
                        <div>
                            <label for="location" class="block text-sm font-medium text-gray-700">Your City & State</label>
                            <input type="text" id="location" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)] sm:text-sm p-3" placeholder="e.g., Mumbai, Maharashtra">
                        </div>
                        <!-- Provider dropdown - initially hidden -->
                        <div id="provider-section" class="hidden">
                            <label for="provider" class="block text-sm font-medium text-gray-700">Confirm Your Electricity Provider</label>
                            <div class="flex items-center space-x-2 mt-1">
                                <select id="provider" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)] sm:text-sm p-3"></select>
                                <div id="provider-spinner" class="spinner mini-spinner"></div>
                            </div>
                        </div>
                         <!-- Other Provider Input - initially hidden -->
                        <div id="other-provider-section" class="hidden">
                             <label for="other-provider" class="block text-sm font-medium text-gray-700">Please specify your provider</label>
                             <input type="text" id="other-provider" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)] sm:text-sm p-3" placeholder="e.g., Your Local DISCOM">
                        </div>
                        <button id="calculate-savings-btn" class="w-full primary-button text-white font-bold py-3 px-4 rounded-md flex items-center justify-center">
                            Calculate Savings
                        </button>
                    </div>
                </div>
                <div id="calculator-spinner" class="spinner"></div>
                <div id="calculator-results" class="mt-12 max-w-3xl mx-auto"></div>
            </div>
        </section>

        <!-- About Section -->
        <section id="about" class="py-20">
            <div class="container mx-auto px-6">
                <div class="flex flex-col md:flex-row-reverse items-center gap-12">
                    <div class="md:w-1/2">
                        <h2 class="text-3xl md:text-4xl font-bold mb-4 text-[var(--secondary-color)]">Our Mission: To Make Clean Energy Simple and Accessible for All</h2>
                        <div class="space-y-4 text-gray-600">
                            <p>Helionenergies was born from a single, powerful idea: that the transition to sustainable energy should be a clear and achievable goal for every Indian household and business. We saw a future powered by the sun, but we also saw the complexity—confusing policies, technical jargon, and high costs—that stood in the way.</p>
                            <p>Our mission is to be your trusted guide on this journey. We are not just a solar company; we are energy consultants dedicated to bringing clarity to the renewable energy landscape. We do the hard work of translating complex government schemes into clear financial benefits and technical specifications into reliable, long-term solutions.</p>
                            <p class="font-semibold text-[var(--secondary-color)]">Our commitment is to empower you with knowledge, provide honest advice, and deliver the right solution for your specific needs. With Helionenergies, you are not just adopting solar; you are making a smart, informed decision for a brighter, more sustainable future.</p>
                        </div>
                    </div>
                    <div class="md:w-1/2">
                        <img src="https://images.unsplash.com/photo-1579583764928-0ef6f4d33959?q=80&w=1974" 
                             onerror="this.onerror=null;this.src='https://placehold.co/600x400/2a9d8f/ffffff?text=Helionenergies';"
                             alt="Energy consultants reviewing plans over a solar panel model" 
                             class="rounded-lg shadow-xl w-full">
                    </div>
                </div>
            </div>
        </section>

        <!-- Blog/News Section -->
        <section id="blog" class="py-20 bg-[var(--light-gray)]">
            <div class="container mx-auto px-6 text-center">
                <h2 class="text-3xl md:text-4xl font-bold mb-4 text-[var(--secondary-color)]">Latest Blog & News</h2>
                <p class="text-gray-600 mb-8 max-w-2xl mx-auto">Stay updated with the latest trends in India's solar industry. Click the button below to get the latest news and insights from the Indian solar sector.</p>
                <button id="generate-blog-btn" class="cta-button text-white font-bold py-3 px-6 rounded-lg text-lg mb-8">✨ Get Latest News</button>
                <div id="blog-spinner" class="spinner"></div>
                <div id="blog-content" class="max-w-2xl mx-auto text-left">
                    <!-- AI generated content will appear here -->
                </div>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="py-20">
            <div class="container mx-auto px-6">
                <div id="form-success-message" class="hidden max-w-xl mx-auto mb-6 p-4 text-center text-green-800 bg-green-100 rounded-lg">
                    Thank you! Your message has been sent successfully.
                </div>
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-4 text-[var(--secondary-color)]">Start Your Solar Journey Today</h2>
                <p class="text-center text-gray-600 mb-12 max-w-2xl mx-auto">Have a question? Fill out the form below for a free, no-obligation consultation, or email us directly at <a href="mailto:helionenergies@outlook.com" class="text-[var(--primary-color)] font-semibold hover:underline">helionenergies@outlook.com</a>.</p>
                <div class="max-w-xl mx-auto bg-white p-8 rounded-lg shadow-2xl">
                    <form action="https://formsubmit.co/helionenergies@outlook.com" method="POST">
                        <div class="grid grid-cols-1 gap-6">
                            <!-- Form Inputs -->
                            <input type="text" name="name" placeholder="Your Name" required class="block w-full rounded-md border-gray-300 shadow-sm focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)] sm:text-sm p-3">
                            <input type="email" name="email" placeholder="Your Email" required class="block w-full rounded-md border-gray-300 shadow-sm focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)] sm:text-sm p-3">
                            <textarea name="message" rows="5" placeholder="Type your message here..." required class="block w-full rounded-md border-gray-300 shadow-sm focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)] sm:text-sm p-3"></textarea>
                            
                            <!-- FormSubmit Settings (Hidden) -->
                            <input type="hidden" name="_subject" value="New Contact Form Submission from Helionenergies Website!">
                            <input type="hidden" name="_captcha" value="false">
                            <!-- *** IMPORTANT: This line redirects the user back to your site after submission *** -->
                            <input type="hidden" name="_next" id="form-redirect-url">


                            <!-- Submit Button -->
                            <button type="submit" class="w-full primary-button text-white font-bold py-3 px-4 rounded-md">Send Message</button>
                        </div>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-[var(--secondary-color)] text-white text-center py-8">
        <div class="container mx-auto px-6">
            <p>&copy; 2025 Helionenergies | All Rights Reserved</p>
            <p>Your Partner in Renewable Energy</p>
            <p class="mt-2"><a href="mailto:helionenergies@outlook.com" class="hover:text-[var(--accent-color)] transition-colors">helionenergies@outlook.com</a></p>
        </div>
    </footer>

    <script type="module">
        // --- Gemini API Integration ---

        // Get references to the DOM elements
        const calculateBtn = document.getElementById('calculate-savings-btn');
        const billInput = document.getElementById('monthly-bill');
        const locationInput = document.getElementById('location');
        const providerSection = document.getElementById('provider-section');
        const providerSelect = document.getElementById('provider');
        const providerSpinner = document.getElementById('provider-spinner');
        const otherProviderSection = document.getElementById('other-provider-section');
        const otherProviderInput = document.getElementById('other-provider');
        const calculatorResultsDiv = document.getElementById('calculator-results');
        const calculatorSpinner = document.getElementById('calculator-spinner');

        const generateBlogBtn = document.getElementById('generate-blog-btn');
        const blogContentDiv = document.getElementById('blog-content');
        const blogSpinner = document.getElementById('blog-spinner');

        const formRedirectUrlInput = document.getElementById('form-redirect-url');
        const formSuccessMessage = document.getElementById('form-success-message');

        /**
         * A helper function to safely create and append a DOM element.
         */
        function createAndAppend(tag, text, classes = [], parent) {
            const element = document.createElement(tag);
            if (text) element.textContent = text;
            if (classes.length > 0) element.classList.add(...classes);
            parent.appendChild(element);
            return element;
        }

        // --- New Feature: Form Success Message ---
        document.addEventListener('DOMContentLoaded', () => {
            // Set the redirect URL for the form dynamically
            formRedirectUrlInput.value = `${window.location.origin}${window.location.pathname}?form-success=true#contact`;

            // Check if the form was successfully submitted
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('form-success')) {
                formSuccessMessage.classList.remove('hidden');
            }
        });


        // --- New Feature: AI Provider Detection ---
        let debounceTimer;
        locationInput.addEventListener('input', () => {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                const location = locationInput.value;
                // BUG FIX: Changed from > 5 to >= 4 to include shorter city names like 'Delhi' or 'Pune'
                if (location.length >= 4) { 
                    fetchProviders(location);
                } else {
                    providerSection.classList.add('hidden');
                    otherProviderSection.classList.add('hidden');
                }
            }, 1000); 
        });

        providerSelect.addEventListener('change', () => {
            if (providerSelect.value === 'other') {
                otherProviderSection.classList.remove('hidden');
            } else {
                otherProviderSection.classList.add('hidden');
            }
        });

        async function fetchProviders(location) {
            providerSection.classList.remove('hidden');
            otherProviderSection.classList.add('hidden');
            providerSpinner.style.display = 'block';
            providerSelect.innerHTML = '<option>Loading providers...</option>';

            const prompt = `List the main electricity distribution companies (DISCOMs) for ${location}, India. Return only a simple comma-separated list. For example: TATA Power, Adani Electricity, MSEDCL`;
            
            try {
                const result = await callGemini(prompt);
                const providers = result.split(',').map(p => p.trim());
                providerSelect.innerHTML = ''; 
                providers.forEach(p => {
                    const option = document.createElement('option');
                    option.value = p;
                    option.textContent = p;
                    providerSelect.appendChild(option);
                });
                // Add the "Other" option
                const otherOption = document.createElement('option');
                otherOption.value = 'other';
                otherOption.textContent = 'My provider is not listed';
                providerSelect.appendChild(otherOption);

            } catch (error) {
                console.error("Could not fetch providers:", error);
                providerSelect.innerHTML = '<option value="other">Please specify provider</option>';
                otherProviderSection.classList.remove('hidden');
            } finally {
                providerSpinner.style.display = 'none';
            }
        }


        // --- Feature 1: AI Savings Calculator ---
        calculateBtn.addEventListener('click', async () => {
            const bill = billInput.value;
            const location = locationInput.value;
            
            let provider;
            if (providerSelect.value === 'other') {
                provider = otherProviderInput.value;
            } else {
                provider = providerSelect.value;
            }

            if (!bill || !location || !provider) {
                const tempAlert = createAndAppend('div', 'Please fill all fields, including your provider.', [], document.body);
                tempAlert.style.cssText = 'position:fixed;top:20px;left:50%;transform:translateX(-50%);background-color:var(--accent-color);color:white;padding:1rem;border-radius:0.5rem;z-index:100;';
                setTimeout(() => tempAlert.remove(), 3000);
                return;
            }

            calculatorSpinner.style.display = 'block';
            calculatorResultsDiv.innerHTML = '';
            calculateBtn.disabled = true;
            calculateBtn.textContent = 'Calculating...';

            const prompt = `Act as a solar energy expert for India with precise, database-level knowledge of state-wise electricity tariffs. A potential customer in ${location}, served by the provider "${provider}", has an average monthly electricity bill of INR ${bill}. 
            Your primary task is to be as accurate as possible.
            1. Using the exact residential tariff structure for "${provider}" in ${location}, perform a reverse calculation to estimate their approximate monthly electricity consumption in kWh (units). State any minor assumptions made, like "Assuming a standard residential LT connection".
            2. Based on this precise consumption estimate, provide a concise solar energy potential analysis.`;
            
            const schema = {
                type: "OBJECT",
                properties: {
                    "estimatedMonthlyConsumptionKwh": { "type": "STRING", "description": "The estimated monthly electricity consumption in kWh, e.g., '350-400 kWh'" },
                    "estimatedSystemSizeKw": { "type": "STRING", "description": "Recommended solar system size in kW to cover this consumption, e.g., '3 kW'" },
                    "estimatedUpfrontCostInr": { "type": "STRING", "description": "A rough estimate of the upfront installation cost in INR, e.g., '₹1,80,000 - ₹2,10,000'" },
                    "estimatedMonthlySavingsInr": { "type": "STRING", "description": "Estimated savings on their electricity bill in INR per month, e.g., '₹2,200 - ₹2,500'" },
                    "paybackPeriodYears": { "type": "STRING", "description": "Estimated time to recover the investment, e.g., '6-8 years'" },
                    "subsidyInfo": { "type": "STRING", "description": "A brief, user-friendly explanation of the PM Surya Ghar subsidy applicable to the recommended system size in India." },
                    "environmentalImpact": { "type": "STRING", "description": "A fun, relatable environmental impact stat, e.g., 'This is like planting 50 trees every year!'" }
                },
                 "required": ["estimatedMonthlyConsumptionKwh", "estimatedSystemSizeKw", "estimatedUpfrontCostInr", "estimatedMonthlySavingsInr", "paybackPeriodYears", "subsidyInfo", "environmentalImpact"]
            };

            try {
                const rawResult = await callGemini(prompt, schema);
                const parsedResult = JSON.parse(rawResult);
                displayCalculatorResults(parsedResult);
            } catch (error) {
                console.error('API or Parsing Error:', error);
                calculatorResultsDiv.innerHTML = '';
                createAndAppend('p', error.message || "Sorry, we couldn't process your request. Please try again later.", ['text-center', 'text-red-500'], calculatorResultsDiv);
            } finally {
                calculatorSpinner.style.display = 'none';
                calculateBtn.disabled = false;
                calculateBtn.textContent = 'Calculate Savings';
            }
        });

        function displayCalculatorResults(data) {
            calculatorResultsDiv.innerHTML = '';
            const container = createAndAppend('div', null, ['bg-white', 'p-6', 'md:p-8', 'rounded-lg', 'shadow-lg', 'border-l-4', 'border-[var(--primary-color)]'], calculatorResultsDiv);
            createAndAppend('h3', 'Your Personalized Solar Estimate', ['text-2xl', 'font-bold', 'text-center', 'mb-6', 'text-[var(--secondary-color)]'], container);

            const currentSituation = createAndAppend('div', null, ['mb-6'], container);
            createAndAppend('h4', 'Your Current Situation', ['text-xl', 'font-bold', 'mb-3', 'text-[var(--primary-color)]'], currentSituation);
            const currentGrid = createAndAppend('div', null, ['grid', 'grid-cols-2', 'gap-4', 'p-4', 'bg-gray-50', 'rounded-lg'], currentSituation);
            createInfoBox(currentGrid, 'Monthly Bill:', `₹ ${billInput.value}`);
            createInfoBox(currentGrid, 'Est. Consumption:', data.estimatedMonthlyConsumptionKwh || 'N/A');
            
            const solution = createAndAppend('div', null, ['mb-6'], container);
            createAndAppend('h4', 'Our Recommended Solar Solution', ['text-xl', 'font-bold', 'mb-3', 'text-[var(--primary-color)]'], solution);
            const solutionGrid = createAndAppend('div', null, ['grid', 'grid-cols-2', 'gap-4', 'p-4', 'bg-gray-50', 'rounded-lg'], solution);
            createInfoBox(solutionGrid, 'System Size:', data.estimatedSystemSizeKw || 'N/A', 'A kilowatt (kW) is a measure of power. This is the peak power your solar system can generate at any instant under ideal conditions.');
            createInfoBox(solutionGrid, 'Est. Upfront Cost:', data.estimatedUpfrontCostInr || 'N/A', 'This is a ballpark figure for the total cost of installation, including panels, inverter, and labor, before any subsidies.');

            const future = createAndAppend('div', null, [], container);
            createAndAppend('h4', 'Your New Financial Future', ['text-xl', 'font-bold', 'mb-3', 'text-[var(--primary-color)]'], future);
            const futureGrid = createAndAppend('div', null, ['grid', 'grid-cols-2', 'gap-4', 'p-4', 'bg-gray-50', 'rounded-lg'], future);
            createInfoBox(futureGrid, 'Est. Monthly Savings:', data.estimatedMonthlySavingsInr || 'N/A');
            createInfoBox(futureGrid, 'Payback Period:', data.paybackPeriodYears || 'N/A', 'This is the estimated time it will take for your savings on electricity bills to equal the initial cost of the system.');

            const subsidyContainer = createAndAppend('div', null, ['mt-6', 'pt-6', 'border-t'], container);
            createAndAppend('h4', 'Government Subsidy (PM-Surya Ghar)', ['font-bold', 'text-xl', 'mb-2', 'text-[var(--primary-color)]'], subsidyContainer);
            createAndAppend('p', data.subsidyInfo, ['text-gray-700'], subsidyContainer);
            createAndAppend('div', `🌍 ${data.environmentalImpact}`, ['mt-6', 'text-center', 'text-xl', 'font-semibold', 'text-green-600', 'bg-green-50', 'p-4', 'rounded-lg'], container);
            
            createAndAppend('p', '*All figures are estimates based on the data provided and typical conditions. A detailed site survey is required for a final quote.', ['text-xs', 'text-gray-500', 'text-center', 'mt-6'], container);

            function createInfoBox(parent, label, value, tooltipText = '') {
                const box = createAndAppend('div', null, ['text-lg'], parent);
                createAndAppend('strong', label, ['block', 'text-base', 'font-semibold', 'text-gray-600'], box);
                const valueSpan = createAndAppend('span', value, ['text-[var(--secondary-color)]', 'font-bold'], box);
                if (tooltipText) {
                    const tooltip = createAndAppend('div', null, ['tooltip', 'ml-2'], valueSpan);
                    tooltip.innerHTML = `<span class="text-xs bg-gray-300 text-gray-700 rounded-full px-2 py-1">?</span><span class="tooltiptext">${tooltipText}</span>`;
                }
            }
        }

        // --- Feature 2: AI-Powered Blog/News ---
        generateBlogBtn.addEventListener('click', async () => {
            blogSpinner.style.display = 'block';
            blogContentDiv.innerHTML = '';
            generateBlogBtn.disabled = true;
            generateBlogBtn.textContent = 'Generating...';
            const date = new Date().toLocaleDateString('en-IN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            const prompt = `Act as a renewable energy journalist in India. Write a short, optimistic, and engaging blog post (about 150 words) for the Helionenergies website. The topic should be a recent positive trend, technology, or policy news in the Indian solar energy sector. Today's date is ${date}. Start with a catchy headline.`;
            try {
                const result = await callGemini(prompt);
                displayBlog(result);
            } catch (error) {
                console.error('Error:', error);
                blogContentDiv.innerHTML = '';
                createAndAppend('p', 'Could not generate an article at this time. Please try again later.', ['text-center', 'text-red-500'], blogContentDiv);
            } finally {
                blogSpinner.style.display = 'none';
                generateBlogBtn.disabled = false;
                generateBlogBtn.textContent = '✨ Get Another News Update';
            }
        });

        function displayBlog(content) {
            blogContentDiv.innerHTML = '';
            const container = createAndAppend('div', null, ['bg-white', 'p-8', 'rounded-lg', 'shadow-lg', 'border-t-4', 'border-[var(--accent-color)]'], container);
            const lines = content.split('\n');
            const headline = lines.shift() || "News Update";
            createAndAppend('h3', headline, ['text-2xl', 'font-bold', 'mb-4', 'text-[var(--secondary-color)]'], container);
            const bodyContainer = createAndAppend('div', null, ['space-y-4'], container);
            lines.forEach(pText => {
                if (pText.trim() !== '') {
                    createAndAppend('p', pText, ['text-gray-700', 'leading-relaxed'], bodyContainer);
                }
            });
        }

        // --- Reusable Gemini API Call Function ---
        async function callGemini(prompt, schema = null) {
            const apiKey = ""; // Leave empty, handled by the environment
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            let payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
            if (schema) {
                payload.generationConfig = {
                    responseMimeType: "application/json",
                    responseSchema: schema
                };
            }
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            if (!response.ok) {
                throw new Error(`API call failed with status: ${response.status}`);
            }
            const result = await response.json();
            if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts[0]) {
                return result.candidates[0].content.parts[0].text;
            } else {
                console.error("Unexpected API response structure:", result);
                if (result.promptFeedback && result.promptFeedback.blockReason) {
                    throw new Error(`Request blocked by API. Reason: ${result.promptFeedback.blockReason}`);
                }
                throw new Error('Content not found in API response.');
            }
        }
    </script>

</body>
</html>
