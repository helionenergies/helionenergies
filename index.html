<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Security Meta Tags -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://generativelanguage.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' https://images.unsplash.com https://placehold.co data:; connect-src 'self' https://generativelanguage.googleapis.com; form-action 'self' https://formsubmit.co;">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta name="referrer" content="strict-origin-when-cross-origin">

    <title>Helionenergies - Compare Solar Quotes from Local Installers</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary-color: #2a9d8f; /* Teal Green */
            --secondary-color: #264653; /* Dark Blue/Green */
            --accent-color: #f4a261; /* Sandy Orange */
            --text-color: #333;
            --bg-color: #ffffff;
            --light-gray: #f8f9fa;
        }
        body { font-family: 'Inter', sans-serif; color: var(--text-color); background-color: var(--bg-color); }
        .font-logo { font-family: 'Lexend Deca', sans-serif; }
        .cta-button { background-color: var(--accent-color); transition: background-color 0.3s ease; }
        .cta-button:hover { background-color: #e76f51; }
        .primary-button { background-color: var(--primary-color); transition: background-color 0.3s ease; }
        .primary-button:hover { background-color: var(--secondary-color); }
        .spinner { border: 4px solid rgba(0, 0, 0, 0.1); width: 24px; height: 24px; border-radius: 50%; border-left-color: var(--primary-color); animation: spin 1s ease infinite; display: none; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .modal-overlay { transition: opacity 0.3s ease; }
        .loading-popup-content { transition: opacity 0.5s ease-in-out; }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Lexend+Deca:wght@700&display=swap" rel="stylesheet">
</head>
<body class="bg-white">

    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="text-3xl font-bold font-logo" style="color: var(--primary-color);">Helionenergies</a>
            <ul class="hidden md:flex items-center space-x-8">
                <li><a href="#marketplace" class="text-gray-700 hover:text-[var(--primary-color)] font-semibold">üìä Compare Quotes</a></li>
                <li><a href="#policies" class="text-gray-700 hover:text-[var(--primary-color)] font-semibold">‚öñÔ∏è Policy Helper</a></li>
                <li><a href="#news" class="text-gray-700 hover:text-[var(--primary-color)] font-semibold">üì° Live News</a></li>
                <li><a href="#about" class="text-gray-700 hover:text-[var(--primary-color)] font-semibold">About Us</a></li>
                <li><a href="#for-vendors" class="text-gray-700 hover:text-[var(--primary-color)] font-semibold">For Vendors</a></li>
                <li><a href="#contact" class="text-gray-700 hover:text-[var(--primary-color)] font-semibold">Contact</a></li>
            </ul>
            <a href="#contact" class="hidden md:block cta-button text-white font-bold py-2 px-6 rounded-lg">Get in Touch</a>
        </nav>
    </header>

    <main>
        <!-- Hero Section -->
        <section class="bg-cover bg-center text-white" style="background-image: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('https://images.unsplash.com/photo-1509391366360-2e959784a276?q=80&w=2070')">
            <div class="container mx-auto px-6 text-center py-24 md:py-32">
                <h1 class="text-4xl md:text-6xl font-bold mb-4">The Smart Way to Go Solar in India</h1>
                <p class="text-lg md:text-xl mb-8 max-w-3xl mx-auto">Get a free, anonymous comparison of quotes from local installers. Pay a small fee only when you're ready to see the full details and connect.</p>
                <a href="#marketplace" class="cta-button text-white font-bold py-4 px-8 rounded-lg text-lg">üìä Get Your Free Comparison Now</a>
            </div>
        </section>
        
        <!-- AI Solar Marketplace Section -->
        <section id="marketplace" class="py-20 bg-[var(--light-gray)]">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-4 text-[var(--secondary-color)]">üìä Solar Marketplace & Quote Comparison</h2>
                <p class="text-center text-gray-600 mb-12 max-w-2xl mx-auto">Ready to install? Tell us your needs, and our AI will generate instant, competitive quotes from local vendors in your area.</p>
                <div class="max-w-xl mx-auto bg-white p-8 rounded-lg shadow-2xl">
                    <div class="grid grid-cols-1 gap-6">
                        <div>
                            <label for="location-marketplace" class="block text-sm font-medium text-gray-700">Project Location (City, State)</label>
                            <input type="text" id="location-marketplace" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)] sm:text-sm p-3" placeholder="e.g., Pune, Maharashtra">
                        </div>
                        <div>
                            <label for="system-size" class="block text-sm font-medium text-gray-700">Desired System Size (kW)</label>
                            <select id="system-size" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)] sm:text-sm p-3">
                                <option>3 kW</option>
                                <option>5 kW</option>
                                <option>10 kW</option>
                                <option>15 kW</option>
                                <option>25 kW</option>
                                <option>50 kW+</option>
                            </select>
                        </div>
                        <div>
                            <label for="panel-type" class="block text-sm font-medium text-gray-700">Preferred Panel Type</label>
                            <select id="panel-type" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)] sm:text-sm p-3">
                                <option>Any (Best Value)</option>
                                <option>Monocrystalline (High Efficiency)</option>
                                <option>Polycrystalline (Cost-Effective)</option>
                            </select>
                        </div>
                        <button id="compare-quotes-btn" class="w-full primary-button text-white font-bold py-3 px-4 rounded-md flex items-center justify-center">
                            Compare Quotes
                        </button>
                    </div>
                </div>
                <div id="marketplace-results" class="mt-12 max-w-5xl mx-auto"></div>
            </div>
        </section>

        <!-- AI Policy Helper Section -->
        <section id="policies" class="py-20">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-4 text-[var(--secondary-color)]">‚öñÔ∏è Policy Helper</h2>
                <p class="text-center text-gray-600 mb-12 max-w-2xl mx-auto">Solar policies can be confusing. Select a policy below to get a simple, clear explanation of what it means for you.</p>
                <div class="max-w-xl mx-auto bg-white p-8 rounded-lg shadow-2xl">
                    <div class="grid grid-cols-1 gap-6">
                        <div>
                            <label for="policy-select" class="block text-sm font-medium text-gray-700">Select a Policy to Understand</label>
                            <select id="policy-select" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)] sm:text-sm p-3">
                                <option value="">-- Choose a policy --</option>
                                <option value="PM Surya Ghar: Muft Bijli Yojana">PM Surya Ghar: Muft Bijli Yojana</option>
                                <option value="Net Metering Policy in India">Net Metering Policy</option>
                                <option value="PM-KUSUM Scheme">PM-KUSUM Scheme</option>
                                <option value="State Solar Policy (General)">State Solar Policies (General Overview)</option>
                            </select>
                        </div>
                        <button id="clarify-policy-btn" class="w-full primary-button text-white font-bold py-3 px-4 rounded-md">
                            Explain This Policy
                        </button>
                    </div>
                </div>
                <div id="policy-results" class="mt-12 max-w-3xl mx-auto"></div>
            </div>
        </section>

        <!-- Live Solar News Section -->
        <section id="news" class="py-20 bg-[var(--light-gray)]">
            <div class="container mx-auto px-6 text-center">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-4 text-[var(--secondary-color)]">üì° Live Solar News Feed</h2>
                <p class="text-gray-600 mb-8 max-w-2xl mx-auto">The latest updates on government policies, technology, and trends in the Indian solar sector.</p>
                <div id="news-content" class="max-w-2xl mx-auto text-left">
                    <!-- AI generated news will appear here -->
                </div>
                <button id="refresh-news-btn" class="mt-8 cta-button text-white font-bold py-3 px-6 rounded-lg text-lg hidden">
                    Refresh Feed
                </button>
            </div>
        </section>

        <!-- About Section -->
        <section id="about" class="py-20">
            <div class="container mx-auto px-6">
                <div class="flex flex-col md:flex-row-reverse items-center gap-12">
                    <div class="md:w-1/2">
                        <h2 class="text-3xl md:text-4xl font-bold mb-4 text-[var(--secondary-color)]">Our Mission: Transparency and Choice in Solar</h2>
                        <div class="space-y-4 text-gray-600">
                            <p>Helionenergies was founded to solve a simple problem: going solar in India is too complicated. Customers face a confusing landscape of vendors, prices, and technologies. We decided to build a better way.</p>
                            <p>Our mission is to bring transparency to the solar industry. We are not a solar installer; we are a neutral marketplace that connects you with a network of pre-vetted, trusted local installers. Our platform empowers you to compare competitive quotes side-by-side, ensuring you get the best possible value for your investment.</p>
                            <p class="font-semibold text-[var(--secondary-color)]">We believe that an informed customer makes the best decision. Our commitment is to provide the tools and data you need to choose the right solar solution with confidence.</p>
                        </div>
                    </div>
                    <div class="md:w-1/2">
                        <img src="https://images.unsplash.com/photo-1579583764928-0ef6f4d33959?q=80&w=1974" 
                             onerror="this.onerror=null;this.src='https://placehold.co/600x400/2a9d8f/ffffff?text=Helionenergies';"
                             alt="Energy consultants reviewing plans over a solar panel model" 
                             class="rounded-lg shadow-xl w-full">
                    </div>
                </div>
            </div>
        </section>

        <!-- For Vendors Section -->
        <section id="for-vendors" class="py-20 bg-[var(--light-gray)]">
            <div class="container mx-auto px-6 text-center">
                <h2 class="text-3xl md:text-4xl font-bold mb-4 text-[var(--secondary-color)]">Are You a Solar Installer?</h2>
                <p class="text-lg md:text-xl mb-8 max-w-2xl mx-auto text-gray-600">Join the Helionenergies network to connect with qualified, local customers who are ready to install solar. Stop chasing leads and start closing deals.</p>
                <a href="#contact" class="cta-button text-white font-bold py-4 px-8 rounded-lg text-lg">Partner With Us</a>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="py-20">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-4 text-[var(--secondary-color)]">Get in Touch</h2>
                <p class="text-center text-gray-600 mb-12 max-w-2xl mx-auto">For customer support or vendor partnership inquiries, please fill out the form below or email us at <a href="mailto:helionenergies@outlook.com" class="text-[var(--primary-color)] font-semibold hover:underline">helionenergies@outlook.com</a>.</p>
                <div class="max-w-xl mx-auto bg-white p-8 rounded-lg shadow-2xl">
                    <form action="https://formsubmit.co/helionenergies@outlook.com" method="POST">
                        <div class="grid grid-cols-1 gap-6">
                            <input type="text" name="name" placeholder="Your Name" required class="block w-full rounded-md border-gray-300 shadow-sm focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)] sm:text-sm p-3">
                            <input type="email" name="email" placeholder="Your Email" required class="block w-full rounded-md border-gray-300 shadow-sm focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)] sm:text-sm p-3">
                            <textarea name="message" rows="5" placeholder="Your Message (e.g., 'I am an installer interested in partnership.')" required class="block w-full rounded-md border-gray-300 shadow-sm focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)] sm:text-sm p-3"></textarea>
                            <input type="hidden" name="_subject" value="New Inquiry from Helionenergies Website!">
                            <input type="hidden" name="_next" value="https://helionenergiesindia.github.io/">
                            <button type="submit" class="w-full primary-button text-white font-bold py-3 px-4 rounded-md">Send Message</button>
                        </div>
                    </form>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Payment/Unlock Modal -->
    <div id="unlock-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-xl p-8 max-w-md w-full space-y-4 text-center">
            <div class="flex justify-end">
                <button id="close-modal-btn" class="text-gray-400 hover:text-gray-600 text-3xl">&times;</button>
            </div>
            <h3 class="text-2xl font-bold text-[var(--secondary-color)]">Unlock Full Vendor Details</h3>
            <p class="text-gray-600">For a one-time fee of <strong class="text-[var(--primary-color)]">‚Çπ199</strong>, you will get instant access to the full, detailed quotes, including vendor names and contact information.</p>
            <button id="proceed-to-pay-btn" class="w-full cta-button text-white font-bold py-3 px-4 rounded-md">Proceed to Pay ‚Çπ199</button>
        </div>
    </div>

    <!-- Innovative Loading Popup -->
    <div id="loading-popup" class="modal-overlay fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-xl p-8 max-w-sm w-full text-center space-y-4">
            <div id="loading-emoji" class="text-5xl"></div>
            <p id="loading-message" class="text-lg font-semibold text-[var(--secondary-color)] loading-popup-content"></p>
        </div>
    </div>


    <!-- Footer -->
    <footer class="bg-[var(--secondary-color)] text-white text-center py-8">
        <div class="container mx-auto px-6">
            <p>&copy; 2025 Helionenergies | All Rights Reserved</p>
            <p>Your Partner in Renewable Energy</p>
            <p class="mt-2"><a href="mailto:helionenergies@outlook.com" class="hover:text-[var(--accent-color)] transition-colors">helionenergies@outlook.com</a></p>
        </div>
    </footer>

    <script type="module">
        // --- SHARED ELEMENTS & FUNCTIONS ---
        const loadingPopup = document.getElementById('loading-popup');
        const loadingMessage = document.getElementById('loading-message');
        const loadingEmoji = document.getElementById('loading-emoji');
        let messageInterval;

        function showLoadingPopup(messages) {
            let messageIndex = 0;
            
            function updateMessage() {
                const { emoji, text } = messages[messageIndex];
                loadingEmoji.style.opacity = 0;
                loadingMessage.style.opacity = 0;
                
                setTimeout(() => {
                    loadingEmoji.textContent = emoji;
                    loadingMessage.textContent = text;
                    loadingEmoji.style.opacity = 1;
                    loadingMessage.style.opacity = 1;
                }, 300);

                messageIndex = (messageIndex + 1) % messages.length;
            }

            loadingPopup.classList.remove('hidden');
            updateMessage(); // Show the first message immediately
            messageInterval = setInterval(updateMessage, 2500);
        }

        function hideLoadingPopup() {
            clearInterval(messageInterval);
            loadingPopup.classList.add('hidden');
        }

        function createAndAppend(tag, text, classes = [], parent) {
            const element = document.createElement(tag);
            if (text) element.textContent = text;
            if (classes.length > 0) element.classList.add(...classes);
            parent.appendChild(element);
            return element;
        }

        async function callGemini(prompt, schema = null) {
            const apiKey = ""; // Leave empty
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            let payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
            if (schema) {
                payload.generationConfig = { responseMimeType: "application/json", responseSchema: schema };
            }
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            if (!response.ok) {
                throw new Error(`API call failed with status: ${response.status}`);
            }
            const result = await response.json();
            if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts[0]) {
                return result.candidates[0].content.parts[0].text;
            } else {
                console.error("Unexpected API response structure:", result);
                if (result.promptFeedback && result.promptFeedback.blockReason) {
                    throw new Error(`Request blocked by API. Reason: ${result.promptFeedback.blockReason}`);
                }
                throw new Error('Content not found in API response.');
            }
        }

        // --- MARKETPLACE QUOTE COMPARISON ---
        const compareBtn = document.getElementById('compare-quotes-btn');
        const locationMarketplaceInput = document.getElementById('location-marketplace');
        const systemSizeSelect = document.getElementById('system-size');
        const panelTypeSelect = document.getElementById('panel-type');
        const marketplaceResultsDiv = document.getElementById('marketplace-results');
        const unlockModal = document.getElementById('unlock-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const proceedToPayBtn = document.getElementById('proceed-to-pay-btn');
        let currentQuotes = []; 

        compareBtn.addEventListener('click', async () => {
            const location = locationMarketplaceInput.value;
            const systemSize = systemSizeSelect.value;
            const panelType = panelTypeSelect.value;

            if (!location) {
                alert('Please enter your project location.');
                return;
            }
            
            showLoadingPopup([
                { emoji: "üó∫Ô∏è", text: `Analyzing ${location}...` },
                { emoji: "üîç", text: "Scanning our vendor network..." },
                { emoji: "üìä", text: "Compiling the best quotes..." },
                { emoji: "‚úÖ", text: "Finalizing your report..." }
            ]);
            marketplaceResultsDiv.innerHTML = '';
            compareBtn.disabled = true;

            const prompt = `Act as a solar marketplace data engine for India. A user in "${location}" wants quotes for a "${systemSize}" solar system using "${panelType}" panels. Generate a list of 3 realistic, distinct, and fictional local solar vendors for that area. Provide a detailed quote for each.`;
            
            const schema = {
                type: "ARRAY",
                items: {
                    type: "OBJECT",
                    properties: {
                        "vendorName": { "type": "STRING" }, "rating": { "type": "NUMBER" }, "totalPriceInr": { "type": "STRING" }, "panelBrand": { "type": "STRING" }, "inverterBrand": { "type": "STRING" }, "keyFeature": { "type": "STRING" }
                    },
                    required: ["vendorName", "rating", "totalPriceInr", "panelBrand", "inverterBrand", "keyFeature"]
                }
            };

            try {
                const rawResult = await callGemini(prompt, schema);
                currentQuotes = JSON.parse(rawResult); 
                displayQuotes(currentQuotes, true); 
            } catch (error) {
                console.error('API or Parsing Error:', error);
                marketplaceResultsDiv.innerHTML = `<p class="text-center text-red-500">Sorry, we couldn't find vendors for your area at this time. Please try a different location.</p>`;
            } finally {
                hideLoadingPopup();
                compareBtn.disabled = false;
            }
        });

        function displayQuotes(quotes, isAnonymous) {
            marketplaceResultsDiv.innerHTML = '';
            const container = createAndAppend('div', null, ['bg-white', 'p-6', 'rounded-lg', 'shadow-lg'], marketplaceResultsDiv);
            const headerText = isAnonymous ? `Top 3 Anonymous Quotes in ${locationMarketplaceInput.value}` : `Full Report: Top 3 Quotes in ${locationMarketplaceInput.value}`;
            const header = createAndAppend('h3', headerText, ['text-2xl', 'font-bold', 'text-center', 'mb-6', 'text-[var(--secondary-color)]'], container);
            const tableContainer = createAndAppend('div', null, ['overflow-x-auto'], container);
            const table = createAndAppend('table', null, ['w-full', 'text-left', 'border-collapse'], tableContainer);
            table.innerHTML = `
                <thead><tr class="bg-gray-100">
                    <th class="p-4 border-b">Vendor</th><th class="p-4 border-b">Rating</th><th class="p-4 border-b">Equipment</th><th class="p-4 border-b text-right">Price Estimate</th><th class="p-4 border-b"></th>
                </tr></thead><tbody></tbody>`;
            const tbody = table.querySelector('tbody');
            
            quotes.forEach((quote, index) => {
                const row = tbody.insertRow();
                row.className = 'hover:bg-gray-50';
                const vendorName = isAnonymous ? `Local Vendor #${index + 1}` : quote.vendorName;
                const priceHtml = isAnonymous 
                    ? `<span class="text-gray-500 italic">Locked</span>`
                    : `<span class="font-bold text-lg text-[var(--primary-color)]">${quote.totalPriceInr}</span>`;
                const buttonHtml = isAnonymous 
                    ? `<button class="unlock-btn primary-button text-white font-bold py-2 px-4 rounded-md text-sm">Unlock Price & Details</button>`
                    : `<a href="#contact" class="primary-button text-white font-bold py-2 px-4 rounded-md text-sm">Contact Now</a>`;

                row.innerHTML = `
                    <td class="p-4 border-b">
                        <div class="font-semibold">${vendorName}</div>
                        <div class="text-sm text-gray-500">${quote.keyFeature}</div>
                    </td>
                    <td class="p-4 border-b text-yellow-500 font-bold">${'‚òÖ'.repeat(Math.round(quote.rating))}${'‚òÜ'.repeat(5 - Math.round(quote.rating))} ${quote.rating}/5</td>
                    <td class="p-4 border-b text-sm"><strong>Panels:</strong> ${quote.panelBrand}<br><strong>Inverter:</strong> ${quote.inverterBrand}</td>
                    <td class="p-4 border-b text-right">${priceHtml}</td>
                    <td class="p-4 border-b text-right">${buttonHtml}</td>
                `;
            });
        }

        marketplaceResultsDiv.addEventListener('click', (e) => {
            if (e.target.classList.contains('unlock-btn')) {
                unlockModal.classList.remove('hidden');
            }
        });

        closeModalBtn.addEventListener('click', () => { unlockModal.classList.add('hidden'); });
        proceedToPayBtn.addEventListener('click', () => {
            unlockModal.classList.add('hidden');
            displayQuotes(currentQuotes, false); 
        });
        unlockModal.addEventListener('click', (e) => {
            if (e.target === unlockModal) { unlockModal.classList.add('hidden'); }
        });

        // --- AI POLICY HELPER ---
        const clarifyPolicyBtn = document.getElementById('clarify-policy-btn');
        const policySelect = document.getElementById('policy-select');
        const policyResults = document.getElementById('policy-results');

        clarifyPolicyBtn.addEventListener('click', async () => {
            const selectedPolicy = policySelect.value;
            if (!selectedPolicy) {
                alert('Please select a policy to explain.');
                return;
            }

            showLoadingPopup([
                { emoji: "üìú", text: `Accessing info on ${selectedPolicy}...` },
                { emoji: "üß†", text: "Simplifying the legal jargon..." },
                { emoji: "‚úçÔ∏è", text: "Preparing your summary..." }
            ]);
            policyResults.innerHTML = '';
            clarifyPolicyBtn.disabled = true;

            const prompt = `Act as a policy expert for the Indian solar sector. Explain the "${selectedPolicy}" in simple, clear terms for a homeowner or small business owner. Focus on three key points: 1. Who is it for? 2. What are the main benefits? 3. How can someone apply or take advantage of it? Also, provide up to two official government URLs as sources.`;
            
            const schema = {
                type: "OBJECT",
                properties: {
                    "explanation": { "type": "STRING" },
                    "sources": { "type": "ARRAY", "items": { "type": "STRING" } }
                },
                required: ["explanation", "sources"]
            };

            try {
                const rawResult = await callGemini(prompt, schema);
                const result = JSON.parse(rawResult);
                displayPolicyClarification(result.explanation, selectedPolicy, result.sources);
            } catch (error) {
                console.error("Could not clarify policy:", error);
                policyResults.innerHTML = `<p class="text-center text-red-500">Sorry, we couldn't get details on this policy right now.</p>`;
            } finally {
                hideLoadingPopup();
                clarifyPolicyBtn.disabled = false;
            }
        });

        function displayPolicyClarification(content, policyName, sources) {
            policyResults.innerHTML = '';
            const container = createAndAppend('div', null, ['bg-white', 'p-8', 'rounded-lg', 'shadow-lg', 'border-t-4', 'border-[var(--accent-color)]'], policyResults);
            createAndAppend('h3', `Understanding: ${policyName}`, ['text-2xl', 'font-bold', 'mb-4', 'text-[var(--secondary-color)]'], container);
            const bodyContainer = createAndAppend('div', null, ['space-y-4'], container);
            const paragraphs = content.split('\n');
            paragraphs.forEach(pText => {
                if (pText.trim() !== '') {
                    createAndAppend('p', pText, ['text-gray-700', 'leading-relaxed'], bodyContainer);
                }
            });

            if (sources && sources.length > 0) {
                const sourcesContainer = createAndAppend('div', null, ['mt-6', 'pt-4', 'border-t'], container);
                createAndAppend('h4', 'Official Sources:', ['font-semibold', 'text-gray-800', 'mb-2'], sourcesContainer);
                const sourceList = createAndAppend('ul', null, ['list-disc', 'list-inside', 'space-y-1'], sourcesContainer);
                sources.forEach(url => {
                    const li = createAndAppend('li', null, [], sourceList);
                    const a = createAndAppend('a', url, ['text-[var(--primary-color)]', 'hover:underline', 'break-all'], li);
                    a.href = url;
                    a.target = "_blank";
                });
            }

            const disclaimer = createAndAppend('p', 'Disclaimer: This AI-generated explanation is for informational purposes. Please consult the official government sources above for legal or financial advice.', ['text-xs', 'text-gray-500', 'italic', 'mt-6', 'text-center'], container);
        }

        // --- LIVE NEWS FEED ---
        const newsContent = document.getElementById('news-content');
        const refreshNewsBtn = document.getElementById('refresh-news-btn');

        async function fetchNews() {
            showLoadingPopup([
                { emoji: "üì°", text: "Scanning the latest solar news..." },
                { emoji: "üì∞", text: "Identifying top stories..." },
                { emoji: "‚ú®", text: "Compiling your news brief..." }
            ]);
            newsContent.innerHTML = '';
            refreshNewsBtn.classList.add('hidden');
            
            const prompt = `Act as a news wire service for the Indian renewable energy sector. Provide the single most important and recent news update (e.g., a major policy announcement, technology breakthrough, or significant investment). Format it with a clear headline, a timestamp, and a concise summary of about 100-150 words. Also, provide the URL of the primary news source.`;

            const schema = {
                type: "OBJECT",
                properties: {
                    "newsItem": { "type": "STRING" },
                    "sourceUrl": { "type": "STRING" }
                },
                required: ["newsItem", "sourceUrl"]
            };

            try {
                const rawResult = await callGemini(prompt, schema);
                const result = JSON.parse(rawResult);
                displayNews(result.newsItem, result.sourceUrl);
            } catch (error) {
                console.error("Could not fetch news:", error);
                newsContent.innerHTML = `<p class="text-center text-red-500">Could not load news feed. Please try refreshing.</p>`;
            } finally {
                hideLoadingPopup();
                refreshNewsBtn.classList.remove('hidden');
            }
        }

        function displayNews(content, sourceUrl) {
            newsContent.innerHTML = '';
            const container = createAndAppend('div', null, ['bg-white', 'p-8', 'rounded-lg', 'shadow-lg', 'border-t-4', 'border-[var(--accent-color)]'], newsContent);
            
            const lines = content.split('\n');
            const headline = lines.shift() || "Latest Solar News";
            
            createAndAppend('h3', headline, ['text-2xl', 'font-bold', 'mb-2', 'text-[var(--secondary-color)]'], container);
            createAndAppend('p', `Updated just now`, ['text-sm', 'text-gray-500', 'mb-4'], container);

            const bodyContainer = createAndAppend('div', null, ['space-y-4'], container);
            lines.forEach(pText => {
                if (pText.trim() !== '') {
                    createAndAppend('p', pText, ['text-gray-700', 'leading-relaxed'], bodyContainer);
                }
            });
            
            if (sourceUrl) {
                const sourcesContainer = createAndAppend('div', null, ['mt-6', 'pt-4', 'border-t'], container);
                createAndAppend('h4', 'Source:', ['font-semibold', 'text-gray-800', 'mb-2'], sourcesContainer);
                const a = createAndAppend('a', sourceUrl, ['text-[var(--primary-color)]', 'hover:underline', 'break-all'], sourcesContainer);
                a.href = sourceUrl;
                a.target = "_blank";
            }

            const disclaimer = createAndAppend('p', 'Disclaimer: This news summary is AI-generated. Please refer to the primary news source for the full report.', ['text-xs', 'text-gray-500', 'italic', 'mt-6', 'text-center'], container);
        }

        refreshNewsBtn.addEventListener('click', fetchNews);
        document.addEventListener('DOMContentLoaded', fetchNews); // Fetch news on page load

    </script>

</body>
</html>
